<style type="text/css">
p{
text-indent: 2em; /*em是相对单位，2em即现在一个字大小的两倍*/
}
</style>


<h2>参考文章</h2>

<p><a href="https://blog.csdn.net/zs_find/article/details/51870462?locationNum=5&fps=1">参考 : 读懂diff的3种格式和git格式的diff</a><br></p>

<p>文章的原始格式太乱了,我做了整理<br></p>

<p>diff是Unix系统的一个很重要的工具程序。它用来比较两个文本文件的差异,是代码版本管理的基石之一</b>,你在命令行下,输入：</p>

<pre>
            $ diff <变动前的文件> <变动后的文件>
</pre>

<p>diff就会告诉你,这两个文件有何差异。它的显示结果不太好懂,下面我就来说明,如何读懂diff。</p>


<h2>diff的三种格式</h2>

<p>由于历史原因,diff有三种格式: </p>
<p>(1)正常格式(normal diff) </p>
<p>(2)上下文格式(context diff) </p>
<p>(3)合并格式(unified diff)</p>


<h2>示例文件</h2>

<p>为了便于讲解,先新建两个示例文件。</p>

<pre>
        第一个文件叫做f1,内容是每行一个a,一共7行。
        a
        a
        a
        a
        a
        a
        a

        第二个文件叫做f2,修改f1而成,第4行变成b,其他不变。
        a
        a
        a
        b
        a
        a
        a
</pre>


<h2>正常格式的diff</h2>

<pre>
        $ diff f1 f2

        这时,diff就会显示正常格式的结果:

        1 4c4
        2 < a
        3 ---
        4 > b
</pre>

<p>第一行是一个提示,用来说明变动位置。4c4,它分成三个部分:前面的4,表示f1的第4行有变化;中间的c表示变动的模式是内容改变change,其他模式还有增加a代表addition和删除d代表deletion,后面的4表示变动后变成f2的第4行</p> 

<p>第二行分成两个部分 < a,前面的小于号,表示要从f1当中去除该行(也就是第4行),后面的a表示该行的内容</p>

<p>第三行用来分割f1和f2</p>

<p>第四行,类似于第二行 > b,前面的大于号表示f2增加了该行,后面的b表示该行的内容</p>

<p>最早的Unix(即AT&T版本的Unix),使用的就是这种格式的diff</p>


<h2>上下文格式的diff</h2>

<p>上个世纪80年代初,加州大学伯克利分校推出BSD版本的Unix时,觉得diff的显示结果太简单,最好加入上下文,便于了解发生的变动。因此,推出了上下文格式的diff。它的使用方法是加入c参数(代表context)。</p>

<pre>
        $ diff -c f1 f2

        输出结果:

        *** f1  2012-08-29 16:45:41.000000000 +0800
        --- f2  2012-08-29 16:45:51.000000000 +0800
        ***************
        *** 1,7 ****
        a
        a
        a
        !a
        a
        a
        a
        --- 1,7 ----
        a
        a
        a
        !b
        a
        a
        a
</pre>


<p>这个结果分成四个部分</p>

<p>第一部分的两行,显示两个文件的基本情况：文件名和时间信息。***表示变动前的文件,---表示变动后的文件。</p>

<p>第二部分是15个星号,将文件的基本情况与变动内容分割开</p>

<p>第三部分显示变动前的文件,即f1文件的变动情况。这时不仅显示发生变化的第4行,还显示第4行的前面三行和后面三行,因此一共显示7行。所以,前面的<b>*** 1,7 ****</b>就表示,从第1行开始连续7行。<b>另外,文件内容的每一行最前面,还有一个标记位。如果为空,表示该行无变化;如果是感叹号(!),表示该行有改动;如果是减号(-),表示该行被删除；如果是加号(+),表示该行为新增。</b></p>

<p>第四部分显示变动后的文件,即f2文件的变动情况。除了变动行(第4行)以外,也是上下文各显示三行,总共显示7行。</p>

<h2>合并格式的diff</h2>

<p>如果两个文件相似度很高,那么上下文格式的diff,将显示大量重复的内容,很浪费空间。1990年,GNU diff率先推出了<b>合并格式</b>的diff,将f1和f2的上下文合并在一起显示。它的使用方法是加入u参数(代表unified(合并))。</p>
<pre>
        $ diff -u f1 f2

        输出结果：
        --- f1  2012-08-29 16:45:41.000000000 +0800
        +++ f2  2012-08-29 16:45:51.000000000 +0800
        @@ -1,7 +1,7 @@
        a
        a
        a
        -a
        +b
        a
        a
        a
</pre>

<p>第一部分,也是文件的基本信息。---表示变动前的文件,+++表示变动后的文件</p>

<p>第二部分,变动的位置用两个@作为起首和结束。前面的-1,7分成三个部分:减号表示第一个文件(即f1文件),1表示第1行,7表示连续7行。合在一起,就表示下面是第一个文件从第1行开始的连续7行。同样的,+1,7表示变动后,第二个文件从第1行开始的连续7行。</p>

<p>第三部分是变动的具体内容。除了有变动的那些行以外,也是上下文各显示3行。它将两个文件的上下文,合并显示在一起,所以叫做<b>合并格式</b>。每一行最前面的标志位,空表示无变动,减号表示第一个文件删除的行,加号表示第二个文件新增的行。</p>



<h2>git格式的diff</h2>

<p>版本管理系统git,使用的是合并格式diff的变体。</p>

<pre>
        $ git diff

        输出结果:

        diff --git a/f1 b/f1
        index 6f8a38c..449b072 100644
        --- a/f1
        +++ b/f1
        @@ -1,7 +1,7 @@
        a
        a
        a
        -a
        +b
        a
        a
        a
</pre>

<p>第一行表示结果为git格式的diff。进行比较的是,a版本的f1(即变动前)和b版本的f1(即变动后)。</p>

<p>第二行表示两个版本的git哈希值(index区域的6f8a38c对象,与工作目录区域的449b072对象进行比较),最后的六位数字是对象的模式(普通文件,644权限)。</p>

<p>第三行表示进行比较的两个文件。---表示变动前的版本,+++表示变动后的版本。</p>

<p>后面的部分与合并格式diff相同。</p>
