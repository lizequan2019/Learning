<!DOCTYPE html>
<html>
<head>
    
<meta charset="utf-8">

<title>【C++】volatile特性总结</title>

<style type="text/css">
    p{
    text-indent: 2em; /*em是相对单位,2em即现在一个字大小的两倍*/
    }
 </style>

</head>
<body>
 
<p>说实话,我使用这个关键字的频率还是不太高的,所以这篇笔记就是记录我遇到过的volatile的特性</p>

<h1>多线程中的使用</h1>

<p>避免编译器为了提高代码执行效率进行过度优化而导致的代码执行顺序改变,可以使用volatile,它可以做到</p>

<pre>
                组织编译器为了提高速度将一个<font color="ff0000"><b>变量</b></font>缓存到寄存器内而不写回

                这里解释一下,寄存器指的是CPU中的寄存器,因为寄存器的读写比内存的读写更快(大概是几千倍)所以编译器会优化成将变量的新值先放到
                CPU寄存器中(<font color="ff0000">CPU寄存器是CPU内部的高速存储单元,用于临时存储数据和指令,但它们并不是共享资源。每个线程(或更准确地说,每个CPU核心在执行线程时)
                都有自己的寄存器集。因此,一个线程无法直接从另一个线程的寄存器中读取数据</font>),而不是写回到内存中,
                这样一来其他线程获取到变量的值依然是旧值,这样就会导致线程安全问题

                而volatile修饰了变量之后,就是告诉编译器,不要用上面的方法优化了,使得变量的值在每次访问时都尽可能地从内存中直接读取,而不是从CPU的寄存器或缓存中读取。
                同时,当变量的值被修改时,这个新值也会被立即写回到内存中,以确保其他线程或程序部分能够看到这个更新。

</pre>
 
</body>
</html>